<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Distributed AI Client Demo</title>
    <style>
        /* 以前のスタイルをここに保持 */
    </style>
</head>
<body>
    <!-- 以前のHTML要素をここに保持 -->

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let chart, timeSeriesChart;
        let taskHistory = [];
        let taskQueue = [];

        // 以前の関数（getDeviceInfo, displayDeviceInfo, createChart, updateTimeSeriesChart）をここに保持

        async function createTask(taskType) {
          const response = await fetch('http://localhost:3000/tasks', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ type: taskType }),
          });
          return response.json();
        }

        async function updateTaskResult(taskId, result) {
          await fetch(`http://localhost:3000/tasks/${taskId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ result }),
          });
        }

        function simulateTask(taskType, iterations = 1000000) {
            return new Promise((resolve) => {
                // 以前のシミュレーションコードをここに保持
            });
        }

        async function runTask(taskType, iterations) {
          document.getElementById('result').textContent = `Running ${taskType}...`;
          try {
            const task = await createTask(taskType);
            const result = await simulateTask(taskType, iterations);
            await updateTaskResult(task.id, result);
            taskHistory.push(result);
            updateResults();
            analyzeResults();
            updateDeviceComparison();
            updateTimeSeriesChart();
          } catch (error) {
            document.getElementById('result').textContent = `Error: ${error.message}`;
          }
        }

        // 以前の関数（runAllTasks, updateResults, analyzeResults, saveDeviceResult, getDeviceResults, updateDeviceComparison, addToQueue, updateQueueDisplay, processQueue, exportResults, toggleDarkMode, runNetworkTest）をここに保持

        // イベントリスナーの設定
        document.getElementById('simulateAllTasks').addEventListener('click', runAllTasks);
        document.getElementById('simulateSimpleTask').addEventListener('click', () => runTask('Simple Task'));
        document.getElementById('simulateImageRecognition').addEventListener('click', () => runTask('Image Recognition'));
        document.getElementById('simulateNLP').addEventListener('click', () => runTask('NLP Task'));
        document.getElementById('runCustomTask').addEventListener('click', () => {
            const iterations = parseInt(document.getElementById('customIterations').value);
            runTask('Custom Task', iterations);
        });
        document.getElementById('exportResults').addEventListener('click', exportResults);
        document.getElementById('processQueue').addEventListener('click', processQueue);
        document.getElementById('toggleDarkMode').addEventListener('click', toggleDarkMode);
        document.getElementById('runNetworkTest').addEventListener('click', runNetworkTest);

        // 初期表示のための関数呼び出し
        displayDeviceInfo();
        updateDeviceComparison();
        updateTimeSeriesChart();
    </script>
</body>
</html>
